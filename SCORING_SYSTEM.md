# 위험도 점수 계산 시스템

## 개요
행위 메타데이터와 텍스트 내용을 분석하여 0-100점 범위의 위험도 점수를 계산합니다.

## 점수 구성

### 행위 패턴 분석 (최대 100점)

| 항목 | 점수 | 조건 | 설명 |
|------|------|------|------|
| 붙여넣기 | 30점 | `wasPasted = true` | 텍스트가 붙여넣기됨 |
| 타이핑 없음 | 20점 | `typingSpeedCps = 0` AND `textLength > 0` | 직접 타이핑하지 않음 |
| 빠른 타이핑 | 20점 | `typingSpeedCps > 5` | 비정상적으로 빠른 타이핑 |
| 수정 없음 | 15점 | `backspaceCount = 0` AND `textLength > 10` AND `!wasPasted` | 수정 없이 완벽한 입력 |
| **머뭇거림** | **15점** | `hesitationCount >= 3` | 1.5초 이상 pause가 3회 이상 |
| **반복 수정** | **15점** | `eraseInputRatio > 0.3` AND `backspaceCount > 5` | 입력 대비 30% 이상 지움 |
| **느린 타이핑** | **10점** | `1000ms < avgTypingInterval < 10000ms` | 평균 타이핑 간격 1초 이상 |
| 잦은 포커스 변경 | 10점 | `focusBlurCount > 5` | 입력 필드 이탈 5회 이상 |
| 빠른 입력 | 10점 | `charsPerSecond > 10` AND `textLength > 20` | 짧은 시간에 긴 텍스트 |

### 텍스트 내용 분석 (최대 55점)

| 항목 | 점수 | 조건 | 설명 |
|------|------|------|------|
| URL 감지 | 25점 | URL 패턴 매칭 | URL 링크 포함 |
| 고액 거래 | 20점 | 금액 >= 1,000,000원 | 백만원 이상 |
| 계좌번호 | 10점 | 계좌번호 패턴 매칭 | 계좌번호 포함 |

## 위험 수준 분류

| 점수 범위 | 위험 수준 | 설명 |
|-----------|----------|------|
| 0-39점 | Low | 안전한 거래로 보입니다 |
| 40-69점 | Medium | 한 번 더 확인해주세요 |
| 70-100점 | High | 주의가 필요합니다 |

## 보이스피싱 감지 로직

### 전화 지시 패턴 감지

다음 3가지 행위 패턴이 보이스피싱 피해자의 전형적인 행동을 나타냅니다:

1. **머뭇거림 (hesitationCount >= 3, +15점)**
   - 1.5초 이상 입력을 멈추는 행위가 3회 이상
   - 전화로 지시를 듣고 입력하는 패턴

2. **반복 수정 (eraseInputRatio > 0.3, +15점)**
   - 입력한 내용의 30% 이상을 지우고 다시 입력
   - 잘못 들었거나 다시 지시받는 경우

3. **느린 타이핑 (avgTypingInterval > 1초, +10점)**
   - 평균 타이핑 간격이 1초 이상
   - 말로 듣고 한 글자씩 입력하는 패턴

### 권고 메시지

위 패턴이 감지되면:
- "누군가의 지시를 받고 있다면 즉시 중단하세요"
- "전화 통화 중이라면 상대방을 의심하세요"

## 점수 계산 예시

### 예시 1: 안전한 송금 (Low - 10점)
```
- 직접 타이핑
- 정상적인 속도
- 수정 있음
- 계좌번호만 포함 (+10점)
총점: 10점 → Low
```

### 예시 2: 의심스러운 송금 (Medium - 55점)
```
- 붙여넣기 (+30점)
- 고액 거래 (+20점)
- 잦은 포커스 변경 (+10점)
총점: 55점 → Medium
```

### 예시 3: 보이스피싱 의심 (High - 85점)
```
- 붙여넣기 (+30점)
- 머뭇거림 3회 이상 (+15점)
- 반복 수정 (+15점)
- 느린 타이핑 (+10점)
- URL 포함 (+25점)
총점: 95점 → High
```

## 구현 파일

- `src/utils/riskScoring.ts` - 점수 계산 로직
- `src/utils/behaviorTracker.ts` - 행위 메타데이터 수집
- `src/utils/riskAnalyzer.ts` - 전체 위험도 분석
- `src/types/api.ts` - 타입 정의
